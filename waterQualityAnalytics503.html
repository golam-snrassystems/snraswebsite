<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="./snrasLogo.png" type="image/icon type">
    <title>Water Quality</title>
    <script src="./detail.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.9/jspdf.plugin.autotable.min.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/8.1.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-auth.js"></script>



     <!-- //////////////map or realtime tracking//////////////////////////////////// -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="leaflet/dist/leaflet.css"></script>
    <!-- ////////////////////////////////////////////////// -->




    <style>
        .body {
            margin: 0;
            width: 100%;
            /* overflow-x: hidden; */
        }



         /* <!-- ////////////////map or real time tracking////////////////////////////////// --> */
        #map {
            height: 500px; /* Set the height of the map */
            /*width: 1230px; */
            border-radius: 1%;
            border: blue dashed 2px;
            left: 8px;
            width: 100%;
        }
        #centerButtonForMap {
            position: absolute;
            top: 80px;
            left: 10px;
            z-index: 1000; 
            padding: 7px;
            background-color: white;
            border: 1px solid #312626;
            border-radius: 8%;
            cursor: pointer;
        } 
          /* <!-- ////////////////////////////////////////////////// --> */


        .controllerButton {
            display: flex;
            box-shadow: 0 8px 16px 0 rgba(0, 0, 0, .2), 0 6px 20px 0 rgba(0, 0, 0, .19);
            align-items: center;
            background-color: #f7f7f7;
            border: 3px solid #f2f2f2;
            border-radius: 10px;
            padding: 8px;
            font-size: 20px;
            font-family: auto;
            justify-content: center;
        }

        .controllerButtonItem {
            display: flex;
            /* box-shadow: 0 8px 16px 0 rgba(0, 0, 0, .2), 0 6px 20px 0 rgba(0, 0, 0, .19); */
            align-items: center;
            color: black;
            background-color: #e4e5e680;
            /* border: 3px solid #f2f2f2; */
            border-radius: 5px;
            padding: 4px;
            margin: 5px;
            font-size: 20px;
            font-family: auto;
            justify-content: center;
            text-decoration: none;
        }

        .loaderClassAnalytics {
            position: absolute;
            top: 50%;
            right: 50%;
            z-index: 9999;
        }

        .realTimeChart {
            display: flex;
            box-shadow: 0.5px 0.5px 0.5px 1px #3f00b3;
            border: 3px solid #f2f2f2;
            border-radius: 10px;
            margin: 15px;
            text-align: center;
            width: 90%;

        }

        .apexcharts-text tspan {
            font-size: larger;
        }


        .canvasMain {
            display: flex;
        }

        .canvas1Css {
            margin: 48px auto 10px;
            width: 47%;
        }

        .canvas2Css {
            margin: 48px auto 10px;
            width: 47%;
        }

        .b1button {
            background-image: linear-gradient(90deg, #45b8fb, #6d87fa, #9a53fa);
            border: none;
            border-radius: 10px;
            color: #fff;
            display: flex;
            font-size: 20px;
            margin: 5px;
            width: 115px;
            height: 50px;
            flex-wrap: nowrap;
            flex-direction: row;
            align-content: center;
            justify-content: center;
            align-items: center;
        }

        .selected {
            box-shadow: 1.5px 1.5px 1.5px 1px #5f5a5c;
        }

        #circle {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .buttonBoxClass {
            display: flex;
            flex-wrap: wrap;
            box-shadow: 0 8px 16px 0 rgba(0, 0, 0, .2), 0 6px 20px 0 rgba(0, 0, 0, .19);
            border: 2px solid black;
            border-radius: 20px;
            margin-top: 20px;
            margin-bottom: 25px;
            width: auto;
            padding: 12px;
            justify-content: center;
        }

        .loaderAnalytics {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #fff;
            border-radius: 50%;
            border-top-color: #007bff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        .loader {
            height: 30px;
            width: 400px;
            position: absolute;
            top: 0;
            bottom: 0;
            left: -155px;
            right: 0;
            margin: auto;
        }

        .loader--dot {
            animation-name: loader;
            animation-timing-function: ease-in-out;
            animation-duration: 3s;
            animation-iteration-count: infinite;
            height: 20px;
            width: 20px;
            border-radius: 100%;
            background-color: black;
            position: absolute;
            border: 2px solid white;
        }

        .loader--dot:first-child {
            background-color: #ff0000;
            animation-delay: 0.5s;
        }

        .loader--dot:nth-child(2) {
            background-color: #00ff00;
            animation-delay: 0.4s;
        }

        .loader--dot:nth-child(3) {
            background-color: #0000ff;
            animation-delay: 0.3s;
        }

        .loader--dot:nth-child(4) {
            background-color: #ffff00;
            animation-delay: 0.2s;
        }

        .loader--dot:nth-child(5) {
            background-color: #ff8000;
            animation-delay: 0.1s;
        }

        .loader--dot:nth-child(6) {
            background-color: #800080;
            animation-delay: 0s;
        }

        .loader--text {
            position: absolute;
            top: 200%;
            left: 0;
            right: 0;
            width: 10rem;
            margin: auto;
        }

        .loader--text:after {
            content: "";
            font-weight: bold;
            animation-name: loading-text;
            animation-duration: 3s;
            animation-iteration-count: infinite;
        }

        @keyframes loader {
            15% {
                transform: translateX(0);
            }

            45% {
                transform: translateX(230px);
            }

            65% {
                transform: translateX(230px);
            }

            95% {
                transform: translateX(0);
            }
        }

        @keyframes loading-text {
            0% {
                content: "";
            }

            25% {
                content: "";
            }

            50% {
                content: "";
            }

            75% {
                content: "";
            }
        }

        @media (max-width: 768px) {
            center {
                display: flex;
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .canvasClass,
            .canvasClass1 {
                width: 100%;
                max-width: 400px;
            }
        }

         /* to scroll through dropdown list */
         .dropdown-menu {
            max-height: 600px; /* Set your desired max height */
            overflow-y: auto;  /* Enable vertical scrolling */
        }
           /* it will not go dropdown to back of table */
           .btn-group {
            position: relative; /* Ensure z-index works */
            z-index: 1050; /* Higher than other elements */
        }
        .dropdown-menu {
            z-index: 1050; /* Optional, but can be set if needed */
        }
    </style>
</head>

<body id="analyticsBodyId" onload="realTime();selectFun('realTime')"
    style="visibility: hidden;background-image: linear-gradient(90deg, #45b8fb, #6d87fa, #9a53fa);">
   

    <div style="text-align: center;"><span
            style="color: black; font-family: 'cairo',serif; font-size: medium;"><b><span></span> <a
                    href="https://codepen.io/a7rarpress" target="_blank"><span
                        style="color: #ff0000;"></span></a></b></span></div>

    <div id="loaderAnalytics" class='loaderClassAnalytics' style="visibility: visible;">
        <div class='loader'>
            <div class='loader--dot'></div>
            <div class='loader--dot'></div>
            <div class='loader--dot'></div>
            <div class='loader--dot'></div>
            <div class='loader--dot'></div>
            <div class='loader--dot'></div>
            <div class='loader--text'></div>
        </div>
    </div>

    <div id="containerIdAnaylicts" class="container text-center" style="margin-top: 5%;">

        <div class="btn-group position-fixed top-0 start-0 p-2 p.solid mx-2">
            <button id="controllerId" type="button" class="dropdown-toggle controllerButton" data-bs-toggle="dropdown"
                aria-expanded="false">
                Y041653632892501
            </button>
            <ul class="dropdown-menu">
                <li><a class="controllerButtonItem" href="./waterQualityAnalytics.html" onclick="">Y041653632892481</a>
                </li>
                <li><a class="controllerButtonItem" href="./waterQualityAnalytics82.html"
                        onclick="">Y041653632892482</a></li>
                <li><a class="controllerButtonItem" href="./waterQualityAnalytics83.html"
                        onclick="">Y041653632892483</a></li>
                <li><a class="controllerButtonItem" href="./waterQualityAnalytics84.html"
                        onclick="">Y041653632892484</a></li>
                <li><a class="controllerButtonItem" href="./waterQualityAnalytics85.html"
                            onclick="">Y041653632892485</a></li>         
                <li><a class="controllerButtonItem" href="./waterQualityAnalytics86.html"
                                onclick="">Y041653632892486</a></li>
                 <li><a class="controllerButtonItem" href="./waterQualityAnalytics87.html"
                                    onclick="">Y041653632892487</a></li>
                <li><a class="controllerButtonItem" href="./waterQualityAnalytics88.html"
                                        onclick="">Y041653632892488</a></li>
                <li><a class="controllerButtonItem" href="./waterQualityAnalytics89.html"
                                            onclick="">Y041653632892489</a></li>
                <li><a class="controllerButtonItem" href="./waterQualityAnalytics90.html"
                                                onclick="">Y041653632892490</a></li>

             <li><a class="controllerButtonItem" href="./waterQualityAnalytics91.html"
                                                    onclick="">Y041653632892491</a></li>

             <li><a class="controllerButtonItem" href="./waterQualityAnalytics92.html"
                                                        onclick="">Y041653632892492</a></li>
               
               
             <li><a class="controllerButtonItem" href="./waterQualityAnalytics93.html"
                                                            onclick="">Y041653632892493</a></li>
           <li><a class="controllerButtonItem" href="./waterQualityAnalytics94.html"
                                                                onclick="">Y041653632892494</a></li>  
             <li><a class="controllerButtonItem" href="./waterQualityAnalytics95.html"
                                                            onclick="">Y041653632892495</a></li>
              <li><a class="controllerButtonItem" href="./waterQualityAnalytics96.html"
                                                             onclick="">Y041653632892496</a></li>
              <li><a class="controllerButtonItem" href="./waterQualityAnalytics97.html"
                                                                onclick="">Y041653632892497</a></li>
              <li><a class="controllerButtonItem" href="./waterQualityAnalytics98.html"
                                                                 onclick="">Y041653632892498</a></li>        
                  <li><a class="controllerButtonItem" href="./waterQualityAnalytics99.html"
                                                                 onclick="">Y041653632892499</a></li>
                <li><a class="controllerButtonItem" href="./waterQualityAnalytics500.html"
                                                                onclick="">Y041653632892500</a></li>
                <li><a class="controllerButtonItem" href="./waterQualityAnalytics501.html"
                                                                onclick="">Y041653632892501</a></li>
                <li><a class="controllerButtonItem" href="./waterQualityAnalytics502.html"
                                                                onclick="">Y041653632892502</a></li>
                <li><a class="controllerButtonItem" href="./waterQualityAnalytics503.html"
                                                                onclick="">Y041653632892503</a></li>
                <li><a class="controllerButtonItem" href="./waterQualityAnalytics504.html"
                                                                onclick="">Y041653632892504</a></li>
                <li><a class="controllerButtonItem" href="./waterQualityAnalytics505.html"
                                                                onclick="">Y041653632892505</a></li>
            </ul>
        </div>

        <div class="position-fixed top-0 end-0 p-2 p.solid ">
            <div style="
                display: flex;
                box-shadow: 0 8px 16px 0 rgba(0, 0, 0, .2), 0 6px 20px 0 rgba(0, 0, 0, .19);
                align-items: center;
                background-color: #f7f7f7;
                border: 1px solid #f2f2f2;
                border-radius: 5px;
                font-size: 20px;
                font-family: auto;
                justify-content: center;">
                <div style="background-color: #bec6c769;
                padding: 4px;
                margin: 5px;
                border-radius: 5px;">
                    <strong style="
                        margin: 3px;
                        padding: 2px;">Device State
                    </strong>
                </div>
                <div id="circle" class="circle" style="margin: 3px;"></div>
            </div>
        </div>
        <div class="row justify-content-center border mt-4 mx-2" style="border-color: rgb(113, 110, 110) !important;
            border-radius: 30px;
            background-color: #fff;
            box-shadow: 2px 2px #8b747452;margin-bottom: 8px;
            ">

            <div class="row">
                <div class="col text-center mt-4">
                    <img src="./snrasLogo.png" alt="" style="width: 150px">
                </div>
            </div>
            <div class="buttonBoxClass">
                <div>
                    <button id="homePage" type="submit" class="b1button" onclick="homePage(), selectFun('homePage')">Home
                        Page</button>
                </div>
                <div>
                    <button id="realTime" class="b1button" type="submit"
                        onclick="realTime();selectFun('realTime')">RealTime</button>
                </div>
                <div>
                    <button id="Day" type="submit" class="b1button" onclick="day();selectFun('Day')">Day</button>
                </div>
                <div>
                    <button id="Week" type="submit" class="b1button" onclick="week();selectFun('Week')">Week</button>
                </div>
                <div>
                    <button id="1Month" type="submit" class="b1button" onclick="OneMonth();selectFun('1Month')">1
                        Month</button>
                </div>
                <div>
                    <button id="6Month" type="submit" class="b1button " onclick="SixMonth();selectFun('6Month')">6
                        Months</button>
                </div>
            </div>
           
            <div class="canvasMain">
                <div id="canvas1" class="canvas1Css col-12 col-md-6 my-4">
                    <canvas id="myChart" class="canvasClass"
                        style="width: 100%; max-width: 600px;border-radius: 15px;padding: 12px;box-shadow: 0 8px 16px 0 rgba(0,0,0,.2), 0 6px 20px 0 rgba(0,0,0,.19);background-color: #f7f7f7;"></canvas>
                </div>
                <div id="phcanvas" class="canvas1Css col-12 col-md-6 my-4 ml-4!important">
                    <canvas id="phChart" class="canvasClass1"
                        style="width: 100%; max-width: 600px;border-radius: 15px;padding: 12px;box-shadow: 0 8px 16px 0 rgba(0,0,0,.2), 0 6px 20px 0 rgba(0,0,0,.19);background-color: #f7f7f7;"></canvas>
                </div>
            </div>
            <div class="canvasMain">
                <div id="tempcanvas" class="canvas1Css col-12 col-md-6 my-4">
                    <canvas id="tempChart" class="canvasClass"
                        style="width: 100%; max-width: 600px;border-radius: 15px;padding: 12px;box-shadow: 0 8px 16px 0 rgba(0,0,0,.2), 0 6px 20px 0 rgba(0,0,0,.19);background-color: #f7f7f7;"></canvas>
                </div>
                <div id="canvas2" class="canvas2Css col-12 col-md-6 my-4 ml-4!important">
                    <canvas id="myChart1" class="canvasClass1"
                        style="width: 100%; max-width: 600px;border-radius: 15px;padding: 12px;box-shadow: 0 8px 16px 0 rgba(0,0,0,.2), 0 6px 20px 0 rgba(0,0,0,.19);background-color: #f7f7f7;"></canvas>
                </div>

            </div>

            <div class="canvasMain">
                <div id="perimetercanvas" class="canvas1Css col-12 col-md-12 my-4">
                    <canvas id="perimeterChart" class="canvasClass"
                        style="width: 100%; max-width: 1200px;border-radius: 15px;padding: 12px;box-shadow: 0 8px 16px 0 rgba(0,0,0,.2), 0 6px 20px 0 rgba(0,0,0,.19);background-color: #f7f7f7;"></canvas>
                </div>
            </div>

            <div>
             <div id="map">
                <button id="centerButtonForMap">
                    <img src="/waterQualityAnalytics87FindMarker.png" height="20px" width="20px"></div>
                </button>   
        </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js" integrity="sha512-puJW3E/qXDqYp9IfhAI54BJEaWIfloJ7JWs7OeD5i6ruC9JZL1gERT1wjtwXFlh7CjE7ZJ+/vcRZRkIYIb6p4g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
            <script src="/socket.io/socket.io.js"></script>
            <script>
                            // Initialize the map
                            const map = L.map('map').setView([51.505, -0.09], 16);
                            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                maxZoom: 19,
                                attribution: 'SNRAS RealTime device Tracking'
                            }).addTo(map);
                    const marker = L.marker([-16.505, 10.09]).addTo(map).bindPopup("Initial Location").openPopup();
                
                let liveMarker = null;
                function updateMap(latitude, longitude, message) {
        if (liveMarker) {
            liveMarker.setLatLng([latitude, longitude]);
            liveMarker.bindPopup(message).openPopup();
        } else {
            liveMarker = L.marker([latitude, longitude]).addTo(map);
            liveMarker.bindPopup(message).openPopup();
        }
    }

    setInterval(() => {
     fetch('http://34.100.201.70:3001/api/coordinates/device501')
            .then(response => response.json())
            .then(data => {
                if (data.latitude && data.longitude) {
                    const elapsedTime = data.lastSeen ? Math.floor((new Date() - new Date(data.lastSeen)) / 1000) : 0;
                    const message = data.offline ? `Last known location (device is offline) ${formatElapsedTime(elapsedTime)}` : "Updated location just now";
                    updateMap(data.latitude, data.longitude, message);
                }
            })
            .catch(error => console.error('Error fetching coordinates:', error));
    }, 5000);

    fetch('http://34.100.201.70:3001/api/last-known-location/device501')
        .then(response => response.json())
        .then(data => {
            if (data.latitude && data.longitude) {
                updateMap(data.latitude, data.longitude, "Last known location");
            }
        })
        .catch(error => console.error('Error fetching last known location:', error));
          
                     document.getElementById('centerButton').addEventListener('click', function() {
                        const markerPosition = marker.getLatLng(); 
                        map.setView(markerPosition, 13); 
                    });
       </script>   

            <div style="display: flex;">
                <div id="chart" class="realTimeChart"></div>
                <div id="phchart" class="realTimeChart"></div>
            </div>
            <div style="display: flex;">
                <div id="tempchart" class="realTimeChart"></div>
                <div id="tdschart" class="realTimeChart"></div>
            </div>
        </div>
    </div>
    <script src="./analytic503.js"></script>

</body>

</html>